<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!--
    NOTICE: Community project. Not an official product of any game studio.
    Branding (Atomic Fizz, Fizz-Tec) is fictional for this prototype.
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
  <title>Atomic Fizz Wallet | Vault-Tec Approved</title>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#00ff66">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Fizz Wallet">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Atomic Fizz Wallet">
  
  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' https://cdn.jsdelivr.net https://unpkg.com 'unsafe-inline';
    connect-src 'self' https://api.mainnet-beta.solana.com https://api.devnet.solana.com https://*.solana.com wss://*.solana.com https://atomicfizzcaps.xyz https://api.atomicfizzcaps.xyz;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com data:;
    img-src 'self' data: https: blob:;
    frame-src 'none';
    object-src 'none';
    base-uri 'self';
  ">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="wallet.css">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="apple-touch-icon" href="/favicon.png">
  
  <!-- API base: local dev vs production -->
  <script>
    window.API_BASE = 'https://atomicfizzcaps.xyz';
    window.BACKEND_URL = 'https://atomicfizzcaps.xyz';
  </script>
</head>
<body>
  <!-- Branding note: fictional names for prototype only -->
  <!-- Fizz-Co / Fizz-Tec branding is community-created and copy-safe -->
<!-- BOOT OVERLAY -->
<div id="boot-overlay">
  <img src="branding/logo.png" id="boot-logo" alt="Loading...">
  <div class="boot-line">INITIALIZING ATOMIC FIZZ WALLET...</div>
  <div class="boot-line">SCANNING WASTELAND NETWORK...</div>
  <div class="boot-line">VERIFYING CAPS LEDGER...</div>
  <div class="boot-line">LOADING PIP-BOY INTERFACE...</div>
</div>

<!-- MAIN WALLET APP -->
<div id="wallet-app" class="crt">
  <div id="wallet-branding">
    <img src="branding/logo.png" id="wallet-logo" alt="Atomic Fizz Caps">
    <h1>ATOMIC FIZZ WALLET</h1>
    <p class="small muted">HavenTech Approved ‚Ä¢ Secure Cross-Chain Transactions</p>
  </div>

  <!-- WALLET CONNECTION SECTION -->
  <section id="wallet-connect-section" class="wallet-card">
    <h2>CONNECT WALLET</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center;">
      <button id="afw-connect" class="btn">üîÆ CONNECT PHANTOM</button>
      <button id="afw-local" class="btn">‚ö° LOCAL FIZZ WALLET</button>
    </div>
    <div id="afw-address" class="mono small muted">WALLET: DISCONNECTED</div>
    <div id="afw-qr" class="mono small muted"></div>
  </section>

  <!-- TAB NAVIGATION -->
  <div class="wallet-tabs">
    <button class="wallet-tab active" data-tab="overview">üìä OVERVIEW</button>
    <button class="wallet-tab" data-tab="tokens">üí∞ TOKENS</button>
    <button class="wallet-tab" data-tab="nfts">üé® NFTs</button>
    <button class="wallet-tab" data-tab="trade">‚ö° TRADE</button>
    <button class="wallet-tab" data-tab="fizzfun">üöÄ FIZZ.FUN</button>
  </div>

  <!-- ============ TAB: OVERVIEW ============ -->
  <div class="tab-content active terminal-boot" id="tab-overview">
    <!-- ON-CHAIN BALANCES -->
    <section class="wallet-card neon-glow">
      <div class="wallet-card-header">
        <span class="card-icon">üíé</span> ON-CHAIN BALANCES
      </div>
      <div class="data-row">
        <span class="data-label">SOL</span>
        <span class="balance-value" id="afw-sol">0.000</span>
      </div>
      <div class="data-row">
        <span class="data-label">FIZZ</span>
        <span class="balance-value" id="afw-fizz">0</span>
      </div>
    </section>

    <!-- WASTELAND STATS -->
    <section class="wallet-card">
      <div class="wallet-card-header">
        <span class="card-icon">‚ò¢Ô∏è</span> WASTELAND STATS
      </div>
      <div class="data-row">
        <span class="data-label">CAPS</span>
        <span class="balance-value" id="afw-caps">0</span>
      </div>
      <div class="data-row">
        <span class="data-label">XP</span>
        <span class="data-value" id="afw-xp">0 / 0</span>
      </div>
      <div class="data-row">
        <span class="data-label">LEVEL</span>
        <span class="data-value" id="afw-level">1</span>
      </div>
    </section>

    <!-- QUICK LINKS -->
    <section class="wallet-card">
      <div class="wallet-card-header">
        <span class="card-icon">üîó</span> QUICK LINKS
      </div>
      <div style="display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
        <a href="/exchange.html" class="btn" target="_blank" rel="noopener">EXCHANGE</a>
        <a href="/bridge.html" class="btn" target="_blank" rel="noopener">üåÄ BRIDGE</a>
        <a href="/nuke.html" class="btn" target="_blank" rel="noopener">üí£ NUKE</a>
      </div>
    </section>
  </div>

  <!-- ============ TAB: TOKENS ============ -->
  <div class="tab-content terminal-boot" id="tab-tokens">
    <!-- PARTNER TOKENS -->
    <section class="wallet-card">
      <div class="wallet-card-header">
        <span class="card-icon">ü™ô</span> PARTNER TOKENS
      </div>
      <div id="partner-tokens">
        <p class="muted small">Connect wallet to view partner token balances...</p>
      </div>
    </section>

    <!-- MULTICHAIN BALANCES -->
    <section class="wallet-card bridge-section">
      <div class="wallet-card-header">
        <span class="card-icon">üåÄ</span> MULTICHAIN BALANCES
      </div>
      <div id="chain-list">
        <p class="muted small">Connect wallet to view cross-chain balances...</p>
      </div>
    </section>

    <!-- CROSS-CHAIN SWAP -->
    <section class="wallet-card">
      <div class="wallet-card-header">
        <span class="card-icon">‚ö°</span> CROSS-CHAIN SWAP
      </div>
      <div id="swap-panel">
        <p class="muted small">Connect wallet to access swapping...</p>
      </div>
    </section>
  </div>

  <!-- ============ TAB: NFTs ============ -->
  <div class="tab-content terminal-boot" id="tab-nfts">
    <!-- FEATURED ITEMS -->
    <section class="wallet-card">
      <div class="wallet-card-header">
        <span class="card-icon">‚≠ê</span> FEATURED ITEMS
      </div>
      <div id="afw-items">
        <p class="muted">No items yet ‚Äî explore the Mojave.</p>
      </div>
    </section>

    <!-- NFT INVENTORY -->
    <section class="wallet-card">
      <div class="wallet-card-header">
        <span class="card-icon">üé®</span> ON-CHAIN NFTs
      </div>
      <div id="afw-nfts">
        <p class="muted">No Atomic Fizz NFTs detected.</p>
      </div>
    </section>
  </div>

  <!-- ============ TAB: TRADE ============ -->
  <div class="tab-content terminal-boot" id="tab-trade">
    <!-- WALLET-TO-WALLET TRADE -->
    <section class="wallet-card">
      <div class="wallet-card-header">
        <span class="card-icon">üí∏</span> WALLET-TO-WALLET TRADE
      </div>

      <div class="entry">
        <label>Recipient Address</label>
        <input id="afw-trade-to" class="mono" placeholder="Enter recipient wallet address">
      </div>

      <div class="entry">
        <label>Amount (FIZZ)</label>
        <input id="afw-trade-amount" class="mono" type="number" min="0" step="0.01" placeholder="0.00">
      </div>

      <button id="afw-trade-send" class="btn">SEND FIZZ</button>
      <div id="afw-trade-status" class="mono small muted"></div>
    </section>
  </div>

  <!-- ============ TAB: FIZZ.FUN ============ -->
  <div class="tab-content terminal-boot" id="tab-fizzfun">
    <!-- FIZZ.FUN HEADER -->
    <section class="wallet-card fizz-fun-section static-noise">
      <div class="wallet-card-header">
        <span class="card-icon">üöÄ</span> FIZZ.FUN TOKEN LAUNCHPAD
      </div>
      <p class="small muted">Create and launch your own Fizz Caps economy tokens. Fair launch bonding curves, Vault-Tec approved.</p>
      
      <!-- User Access Status -->
      <div id="fizz-access-status" class="wallet-card" style="margin-top: 1.5rem;">
        <div class="skeleton" style="height: 60px; display: none;" id="fizz-loading"></div>
        <div id="fizz-access-info" style="display: none;">
          <div class="data-row">
            <span class="data-label">YOUR TIER:</span>
            <span id="fizz-tier" class="tier-badge">LOADING...</span>
          </div>
          <div class="data-row">
            <span class="data-label">CAPS BALANCE:</span>
            <span class="data-value" id="fizz-caps-balance">0</span>
          </div>
          <div class="data-row">
            <span class="data-label">CAN LAUNCH:</span>
            <span class="data-value" id="fizz-can-launch">NO</span>
          </div>
          <div class="data-row" id="fizz-launch-fee-row" style="display: none;">
            <span class="data-label">LAUNCH FEE:</span>
            <span class="data-value" id="fizz-launch-fee">100 CAPS</span>
          </div>
        </div>
        <p class="small muted" id="fizz-access-message">Connect wallet to check access...</p>
      </div>
    </section>

    <!-- TOKEN LISTING -->
    <section class="wallet-card">
      <div class="wallet-card-header">
        <span class="card-icon">üìà</span> ACTIVE TOKENS
      </div>
      
      <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
        <button class="btn" id="fizz-sort-volume">VOLUME</button>
        <button class="btn" id="fizz-sort-newest">NEWEST</button>
        <button class="btn" id="fizz-sort-graduating">GRADUATING</button>
        <button class="btn" id="fizz-refresh">üîÑ REFRESH</button>
      </div>

      <div id="fizz-token-list" class="token-grid">
        <div class="skeleton" style="height: 200px;"></div>
        <div class="skeleton" style="height: 200px;"></div>
        <div class="skeleton" style="height: 200px;"></div>
      </div>
    </section>

    <!-- TRADE PANEL -->
    <section class="wallet-card trade-panel" id="fizz-trade-section" style="display: none;">
      <div class="wallet-card-header">
        <span class="card-icon">üí±</span> TRADE: <span id="fizz-selected-symbol">N/A</span>
      </div>
      
      <div id="fizz-selected-info" style="margin-bottom: 1.5rem;">
        <!-- Filled dynamically -->
      </div>

      <div class="trade-controls">
        <button class="btn" id="fizz-action-buy">BUY</button>
        <button class="btn" id="fizz-action-sell">SELL</button>
      </div>

      <div class="trade-input-group">
        <label class="trade-label" id="fizz-input-label">SOL AMOUNT</label>
        <input type="number" class="mono" id="fizz-trade-amount" placeholder="0.0" step="0.01" min="0">
      </div>

      <div class="quote-display" id="fizz-quote" style="display: none;">
        <!-- Quote details filled dynamically -->
      </div>

      <button class="btn" id="fizz-execute-trade" style="width: 100%;">EXECUTE TRADE</button>
      <div id="fizz-trade-status" class="mono small muted" style="margin-top: 1rem;"></div>
    </section>

    <!-- TOKEN LAUNCH FORM -->
    <section class="wallet-card" id="fizz-launch-section" style="display: none;">
      <div class="wallet-card-header">
        <span class="card-icon">üöÄ</span> LAUNCH NEW TOKEN
      </div>
      
      <div class="trade-input-group">
        <label class="trade-label">TOKEN NAME</label>
        <input type="text" class="mono" id="fizz-launch-name" placeholder="My Wasteland Token" maxlength="32">
      </div>

      <div class="trade-input-group">
        <label class="trade-label">SYMBOL</label>
        <input type="text" class="mono" id="fizz-launch-symbol" placeholder="MWT" maxlength="10" style="text-transform: uppercase;">
      </div>

      <div class="trade-input-group">
        <label class="trade-label">METADATA URI</label>
        <input type="text" class="mono" id="fizz-launch-uri" placeholder="https://..." maxlength="200">
      </div>

      <button class="btn" id="fizz-execute-launch" style="width: 100%;">LAUNCH TOKEN</button>
      <div id="fizz-launch-status" class="mono small muted" style="margin-top: 1rem;"></div>
    </section>

    <!-- PROTOCOL STATS -->
    <section class="wallet-card">
      <div class="wallet-card-header">
        <span class="card-icon">üìä</span> PROTOCOL STATS
      </div>
      <div id="fizz-stats">
        <div class="data-row">
          <span class="data-label">TOTAL TOKENS LAUNCHED:</span>
          <span class="data-value" id="fizz-stat-tokens">0</span>
        </div>
        <div class="data-row">
          <span class="data-label">TOTAL VOLUME:</span>
          <span class="data-value" id="fizz-stat-volume">0 SOL</span>
        </div>
        <div class="data-row">
          <span class="data-label">CAPS BURNED:</span>
          <span class="data-value" id="fizz-stat-caps">0</span>
        </div>
      </div>
    </section>

    <button id="buy-usdc-button" class="btn" style="width: 100%; margin-top: 1.5rem;">üí∞ BUY USDC (MOONPAY)</button>
  </div>

</div> <!-- END WALLET APP -->

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toast-container"></div>

<!-- NFT DETAIL POPUP -->
<div id="nft-modal" class="modal hidden">
  <div class="modal-content crt">
    <button id="nft-modal-close" class="btn modal-close">CLOSE</button>

    <div id="nft-modal-body">
      <!-- Filled dynamically -->
    </div>

    <div class="modal-actions">
      <button id="nft-equip" class="btn">EQUIP</button>
      <button id="nft-scrap" class="btn">SCRAP</button>
      <button id="nft-fuse" class="btn">FUSE</button>
    </div>
  </div>
</div>

<!-- FUSION POPUP -->
<div id="fusion-modal" class="modal hidden">
  <div class="modal-content crt">
    <button id="fusion-close" class="btn modal-close">CLOSE</button>
    <h2>FUSION</h2>
    <div id="fusion-body"></div>
    <button id="fusion-start" class="btn">FUSE</button>
  </div>
</div>

<!-- SCRIPTS -->
<script src="/js/main.js"></script>
<script src="/js/modules/web3-wallet-adapter.js"></script>
<script src="wallet.js"></script>

<!-- Wallet Integration Script -->
<script>
(function() {
  'use strict';
  
  // Wait for web3Wallet to be available
  function initWalletIntegration() {
    if (typeof window.web3Wallet === 'undefined') {
      setTimeout(initWalletIntegration, 100);
      return;
    }
    
    // Wire web3-wallet-adapter to wallet UI
    const connectBtn = document.getElementById('afw-connect');
    const localBtn = document.getElementById('afw-local');
    
    if (connectBtn) {
      connectBtn.addEventListener('click', async () => {
        try {
          const success = await window.web3Wallet.connect('phantom');
          if (success && window.refreshOnChain) {
            await window.refreshOnChain(window.web3Wallet.getWalletAddress());
          }
        } catch (err) {
          console.error('[Wallet] Phantom connect failed:', err);
        }
      });
    }
    
    if (localBtn) {
      localBtn.addEventListener('click', async () => {
        try {
          const success = await window.web3Wallet.connect('integrated');
          if (success && window.refreshOnChain) {
            await window.refreshOnChain(window.web3Wallet.getWalletAddress());
          }
        } catch (err) {
          console.error('[Wallet] Integrated wallet connect failed:', err);
        }
      });
    }
    
    // Listen for wallet state changes
    window.addEventListener('web3WalletStateChanged', (e) => {
      const { connected, address, type } = e.detail;
      const addrEl = document.getElementById('afw-address');
      
      if (addrEl) {
        if (connected && address) {
          addrEl.textContent = `WALLET: ${address.slice(0, 6)}...${address.slice(-4)} (${type})`;
          addrEl.style.color = 'var(--vault-gold)';
        } else {
          addrEl.textContent = 'WALLET: DISCONNECTED';
          addrEl.style.color = '';
        }
      }
      
      // Update global PLAYER_WALLET for compatibility
      window.PLAYER_WALLET = connected ? address : null;
    });
    
    // Check for existing connection
    if (window.web3Wallet.isConnected()) {
      const addr = window.web3Wallet.getWalletAddress();
      window.PLAYER_WALLET = addr;
      if (window.refreshOnChain) {
        window.refreshOnChain(addr);
      }
    }
    
    console.log('[Wallet] Integration initialized');
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initWalletIntegration);
  } else {
    initWalletIntegration();
  }
})();
</script>

</body>
</html>
