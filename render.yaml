services:
  # ============================
  # 1. BACKEND API (Express)
  # ============================
  - type: web
    name: atomic-backend
    rootDir: backend
    env: node
    plan: starter
    buildCommand: "npm install"
    startCommand: "node server.js"
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      # Do not hardcode PORT here; Render provides process.env.PORT to the runtime
      - key: SOLANA_RPC
        sync: false
      - key: TOKEN_MINT
        sync: false
      - key: GAME_VAULT_SECRET
        sync: false
      - key: REDIS_URL
        sync: false
      - key: SERVER_SECRET_KEY
        sync: false
      - key: SERVER_PUBKEY
        sync: false
      - key: HF_API_KEY
        sync: false
      - key: COOLDOWN_SECONDS
        sync: false
      - key: CLAIM_RADIUS_M
        sync: false
      - key: ADMIN_WALLETS
        sync: false

  # ============================
  # 2. GAME UI (Next.js)
  # ============================
  - type: web
    name: atomic-game-ui
    rootDir: game-ui
    env: node
    plan: starter
    buildCommand: "npm install && npm run build"
    # Ensure your package.json start script uses process.env.PORT (e.g., "next start -p $PORT")
    startCommand: "npm start"
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_BACKEND_URL
        sync: false
      - key: NEXT_PUBLIC_SOLANA_RPC
        sync: false
      - key: NEXT_PUBLIC_TOKEN_MINT
        sync: false

  # ============================
  # 3. PIP-BOY STATIC SITE
  # ============================
  - type: static
    name: atomic-pipboy
    rootDir: public
    staticPublishPath: "."
    buildCommand: ""
    autoDeploy: true
